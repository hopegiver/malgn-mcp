{
  "slug": "email",
  "title": "이메일 발송",
  "category": "util",
  "content": "# 이메일 발송\n\n[← 목차로 돌아가기](README.md)\n\n---\n\n## 개요\n\n맑은프레임워크는 Gmail 클래스를 통해 간편하게 이메일을 발송할 수 있습니다. Gmail, 네이버 메일, AWS SES 등 다양한 SMTP 서버를 지원합니다.\n\n### 주요 기능\n\n- **다양한 SMTP 지원**: Gmail, 네이버, AWS SES, 자체 SMTP 서버\n- **파일 첨부**: 여러 파일 첨부 가능\n- **HTML 이메일**: HTML 형식의 이메일 본문 지원\n- **여러 수신자**: 한 번에 여러 명에게 발송\n- **간편한 설정**: Config를 통한 기본 설정\n\n---\n\n## 기본 이메일 발송\n\n### 1. Malgn 클래스 사용 (가장 간단)\n\nConfig에 설정된 기본 메일 서버를 사용합니다:\n\n```jsp\n<%@ page contentType=\"text/html; charset=utf-8\" %><%@ include file=\"/init.jsp\" %><%\n\n// 가장 간단한 방법\nm.mail(\"user@example.com\", \"제목\", \"내용\");\n\n%>\n```\n\n### 2. Gmail 클래스 사용 (기본 설정)\n\n```jsp\n<%@ page contentType=\"text/html; charset=utf-8\" %><%@ include file=\"/init.jsp\" %><%\n\nGmail mail = new Gmail();\nmail.send(\"user@example.com\", \"안녕하세요\", \"테스트 메일입니다.\");\n\n%>\n```\n\n---\n\n## Gmail 계정 사용\n\nGmail SMTP를 통해 이메일을 발송할 수 있습니다.\n\n### 1. Gmail 앱 비밀번호 발급\n\n1. Google 계정 설정 → 보안\n2. 2단계 인증 활성화\n3. 앱 비밀번호 생성 (16자리)\n\n### 2. Gmail로 발송\n\n```jsp\n<%@ page contentType=\"text/html; charset=utf-8\" %><%@ include file=\"/init.jsp\" %><%\n\n// Gmail 계정 정보 설정\nGmail mail = new Gmail(\"your-email@gmail.com\", \"앱비밀번호\");\n\n// 이메일 발송\nmail.send(\"recipient@example.com\", \"제목입니다\", \"본문 내용입니다.\");\n\n%>\n```\n\n### 3. 전체 예제\n\n**send_email.jsp**:\n```jsp\n<%@ page contentType=\"text/html; charset=utf-8\" %><%@ include file=\"/init.jsp\" %><%\n\nf.addElement(\"email\", null, \"required:'Y', type:'email'\");\nf.addElement(\"subject\", null, \"required:'Y'\");\nf.addElement(\"message\", null, \"required:'Y'\");\n\nif(m.isPost() && f.validate()) {\n\n    String toEmail = f.get(\"email\");\n    String subject = f.get(\"subject\");\n    String message = f.get(\"message\");\n\n    try {\n        Gmail mail = new Gmail(\"your-email@gmail.com\", \"앱비밀번호\");\n        mail.send(toEmail, subject, message);\n\n        m.jsAlert(\"이메일이 발송되었습니다.\");\n        m.jsReplace(\"list.jsp\");\n    } catch(Exception e) {\n        m.jsError(\"이메일 발송 실패: \" + e.getMessage());\n    }\n    return;\n}\n\np.setBody(\"mail.send_form\");\np.setVar(\"form_script\", f.getScript());\np.display();\n\n%>\n```\n\n---\n\n## 네이버 메일 사용\n\n네이버 메일 SMTP를 통해 발송할 수 있습니다.\n\n### 1. 네이버 메일 설정\n\n```jsp\nGmail mail = new Gmail(\"smtp.naver.com\", \"네이버아이디\", \"비밀번호\");\nmail.setMailFrom(\"네이버아이디@naver.com\");\nmail.send(\"recipient@example.com\", \"제목\", \"내용\");\n```\n\n### 2. 전체 예제\n\n```jsp\n<%@ page contentType=\"text/html; charset=utf-8\" %><%@ include file=\"/init.jsp\" %><%\n\nString naverId = \"your_naver_id\";\nString naverPw = \"your_password\";\n\nGmail mail = new Gmail(\"smtp.naver.com\", naverId, naverPw);\nmail.setMailFrom(naverId + \"@naver.com\");\n\nmail.send(\"recipient@example.com\", \"네이버 메일 테스트\", \"안녕하세요. 네이버 메일로 발송합니다.\");\n\nm.p(\"이메일이 발송되었습니다.\");\n\n%>\n```\n\n---\n\n## AWS SES 사용\n\nAmazon Simple Email Service를 통해 대량 이메일을 안정적으로 발송할 수 있습니다.\n\n### 1. AWS SES 설정\n\n1. AWS SES 콘솔에서 이메일 주소 인증\n2. SMTP 자격 증명 생성\n3. 리전별 SMTP 엔드포인트 확인\n\n### 2. AWS SES로 발송\n\n```jsp\n<%@ page contentType=\"text/html; charset=utf-8\" %><%@ include file=\"/init.jsp\" %><%\n\nString sesHost = \"email-smtp.ap-northeast-2.amazonaws.com\";  // 서울 리전\nString sesUsername = \"AKIAXXXXXXXXXXXXXXXX\";  // SMTP 사용자 이름\nString sesPassword = \"xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx\";  // SMTP 비밀번호\n\nGmail mail = new Gmail(sesHost, sesUsername, sesPassword);\nmail.setMailFrom(\"verified@yourdomain.com\");  // SES에서 인증된 이메일\n\nmail.send(\"recipient@example.com\", \"AWS SES 테스트\", \"AWS SES를 통해 발송합니다.\");\n\nm.p(\"이메일이 발송되었습니다.\");\n\n%>\n```\n\n---\n\n## 파일 첨부\n\n### 1. 단일 파일 첨부\n\n```jsp\n<%@ page contentType=\"text/html; charset=utf-8\" %><%@ include file=\"/init.jsp\" %><%\n\nString filePath = Config.getDataDir() + \"/file/document.pdf\";\n\nGmail mail = new Gmail(\"your-email@gmail.com\", \"앱비밀번호\");\nmail.send(\n    \"recipient@example.com\",\n    \"파일 첨부 메일\",\n    \"첨부 파일을 확인해주세요.\",\n    new String[] { filePath }\n);\n\nm.p(\"첨부 파일과 함께 발송되었습니다.\");\n\n%>\n```\n\n### 2. 여러 파일 첨부\n\n```jsp\n<%@ page contentType=\"text/html; charset=utf-8\" %><%@ include file=\"/init.jsp\" %><%\n\nString[] files = {\n    Config.getDataDir() + \"/file/document1.pdf\",\n    Config.getDataDir() + \"/file/document2.pdf\",\n    Config.getDataDir() + \"/file/image.jpg\"\n};\n\nGmail mail = new Gmail(\"your-email@gmail.com\", \"앱비밀번호\");\nmail.send(\"recipient@example.com\", \"여러 파일 첨부\", \"파일들을 확인해주세요.\", files);\n\nm.p(\"여러 파일과 함께 발송되었습니다.\");\n\n%>\n```\n\n### 3. 업로드된 파일 첨부\n\n```jsp\n<%@ page contentType=\"text/html; charset=utf-8\" %><%@ include file=\"/init.jsp\" %><%\n\nf.addElement(\"email\", null, \"required:'Y', type:'email'\");\nf.addElement(\"subject\", null, \"required:'Y'\");\nf.addElement(\"message\", null, \"required:'Y'\");\nf.addElement(\"file\", null, \"\");\n\nif(m.isPost() && f.validate()) {\n\n    String toEmail = f.get(\"email\");\n    String subject = f.get(\"subject\");\n    String message = f.get(\"message\");\n\n    // 파일 업로드\n    File uploadedFile = f.saveFile(\"file\");\n    String[] files = null;\n\n    if(uploadedFile != null) {\n        files = new String[] { uploadedFile.getAbsolutePath() };\n    }\n\n    // 이메일 발송\n    Gmail mail = new Gmail(\"your-email@gmail.com\", \"앱비밀번호\");\n    mail.send(toEmail, subject, message, files);\n\n    m.jsAlert(\"이메일이 발송되었습니다.\");\n    m.jsReplace(\"list.jsp\");\n    return;\n}\n\np.setBody(\"mail.send_form_with_file\");\np.setVar(\"form_script\", f.getScript());\np.display();\n\n%>\n```\n\n---\n\n## HTML 이메일\n\nHTML 형식의 이메일을 발송할 수 있습니다.\n\n### 1. HTML 본문\n\n```jsp\n<%@ page contentType=\"text/html; charset=utf-8\" %><%@ include file=\"/init.jsp\" %><%\n\nString htmlBody = \"<html>\" +\n    \"<body>\" +\n    \"<h1 style='color: #333;'>안녕하세요!</h1>\" +\n    \"<p>이것은 <strong>HTML</strong> 이메일입니다.</p>\" +\n    \"<p style='color: #666;'>HTML 태그를 사용할 수 있습니다.</p>\" +\n    \"<hr>\" +\n    \"<p><a href='https://example.com' style='color: #007bff;'>링크 보기</a></p>\" +\n    \"</body>\" +\n    \"</html>\";\n\nGmail mail = new Gmail(\"your-email@gmail.com\", \"앱비밀번호\");\nmail.send(\"recipient@example.com\", \"HTML 이메일\", htmlBody);\n\nm.p(\"HTML 이메일이 발송되었습니다.\");\n\n%>\n```\n\n### 2. 템플릿을 사용한 HTML 이메일\n\n```jsp\n<%@ page contentType=\"text/html; charset=utf-8\" %><%@ include file=\"/init.jsp\" %><%\n\n// 사용자 정보 조회\nint userId = m.ri(\"user_id\");\nUserDao user = new UserDao();\nDataSet info = user.find(\"id = ?\", new Object[]{userId});\n\nif(info.next()) {\n\n    // init.jsp의 Page 객체(p) 활용\n    p.setBody(\"mail.welcome\");\n    p.setVar(\"name\", info.s(\"name\"));\n    p.setVar(\"email\", info.s(\"email\"));\n    p.setVar(\"site_url\", Config.getSiteUrl());\n\n    String htmlBody = p.fetch();\n\n    // 이메일 발송\n    Gmail mail = new Gmail();\n    mail.send(info.s(\"email\"), \"회원가입을 환영합니다\", htmlBody);\n\n    m.p(\"회원가입 환영 이메일이 발송되었습니다.\");\n}\n\n%>\n```\n\n---\n\n## 여러 수신자\n\n### 1. 여러 명에게 발송\n\n```jsp\n<%@ page contentType=\"text/html; charset=utf-8\" %><%@ include file=\"/init.jsp\" %><%\n\nString[] recipients = {\n    \"user1@example.com\",\n    \"user2@example.com\",\n    \"user3@example.com\"\n};\n\nGmail mail = new Gmail(\"your-email@gmail.com\", \"앱비밀번호\");\nmail.send(recipients, \"공지사항\", \"중요한 공지사항입니다.\");\n\nm.p(\"여러 명에게 발송되었습니다.\");\n\n%>\n```\n\n### 2. DB에서 조회하여 발송\n\n```jsp\n<%@ page contentType=\"text/html; charset=utf-8\" %><%@ include file=\"/init.jsp\" %><%\n\n// 이메일 수신 동의한 회원 조회\nUserDao user = new UserDao();\nDataSet userList = user.find(\"email_agree = 'Y'\");\n\nArrayList<String> emailList = new ArrayList<>();\nwhile(userList.next()) {\n    emailList.add(userList.s(\"email\"));\n}\n\nif(emailList.size() > 0) {\n    String[] recipients = emailList.toArray(new String[0]);\n\n    String subject = \"이벤트 안내\";\n    String message = \"안녕하세요. 특별 이벤트를 안내드립니다...\";\n\n    Gmail mail = new Gmail();\n    mail.send(recipients, subject, message);\n\n    m.p(emailList.size() + \"명에게 이메일을 발송했습니다.\");\n} else {\n    m.p(\"발송할 이메일이 없습니다.\");\n}\n\n%>\n```\n\n### 3. 개별 발송 (개인화)\n\n```jsp\n<%@ page contentType=\"text/html; charset=utf-8\" %><%@ include file=\"/init.jsp\" %><%\n\nUserDao user = new UserDao();\nDataSet userList = user.find(\"email_agree = 'Y'\");\n\nGmail mail = new Gmail(\"your-email@gmail.com\", \"앱비밀번호\");\n\nint sentCount = 0;\nwhile(userList.next()) {\n    String email = userList.s(\"email\");\n    String name = userList.s(\"name\");\n\n    String subject = name + \"님께 특별 제안\";\n    String message = \"<h1>\" + name + \"님, 안녕하세요!</h1>\" +\n                     \"<p>\" + name + \"님을 위한 특별한 혜택을 준비했습니다.</p>\";\n\n    try {\n        mail.send(email, subject, message);\n        sentCount++;\n    } catch(Exception e) {\n        m.p(\"발송 실패: \" + email + \" - \" + e.getMessage());\n    }\n}\n\nm.p(\"총 \" + sentCount + \"명에게 개별 이메일을 발송했습니다.\");\n\n%>\n```\n\n### 4. 대량 발송 (백그라운드 스레드)\n\n대량의 이메일을 발송할 때는 `m.mailer()` 메소드를 사용하여 백그라운드 스레드로 처리할 수 있습니다.\n\n#### 기본 사용법\n\n```jsp\n<%@ page contentType=\"text/html; charset=utf-8\" %><%@ include file=\"/init.jsp\" %><%\n\n// 백그라운드 스레드로 이메일 발송 (논블로킹)\nm.mailer(\"user@example.com\", \"제목\", \"내용\");\n\n// 즉시 다음 코드 실행 (이메일 발송 완료를 기다리지 않음)\nm.p(\"이메일이 발송 대기열에 추가되었습니다.\");\n\n%>\n```\n\n#### m.mail() vs m.mailer() 비교\n\n| 메소드 | 처리 방식 | 속도 | 사용 시기 |\n|--------|----------|------|----------|\n| `m.mail()` | 동기 (블로킹) | 느림 (발송 완료까지 대기) | 1~10건 정도의 소량 발송, 발송 성공 여부를 즉시 확인해야 할 때 |\n| `m.mailer()` | 비동기 (논블로킹) | 빠름 (즉시 반환) | 수십~수백 건의 대량 발송, 발송 완료를 기다릴 필요 없을 때 |\n\n---\n\n## 환경설정\n\n### 1. config.xml 설정\n\n**WEB-INF/config/config.xml**:\n```xml\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<config>\n    <!-- 메일 서버 설정 -->\n    <mailHost>smtp.gmail.com</mailHost>\n    <mailPort>587</mailPort>\n    <mailFrom>your-email@gmail.com</mailFrom>\n    <mailUser>your-email@gmail.com</mailUser>\n    <mailPass>your-app-password</mailPass>\n</config>\n```\n\n### 2. 기본 설정 사용\n\n```jsp\n// config.xml에 설정된 정보로 자동 초기화\nGmail mail = new Gmail();\nmail.send(\"recipient@example.com\", \"제목\", \"내용\");\n```\n\n### 3. 수동 설정\n\n```jsp\nGmail mail = new Gmail();\n\n// SMTP 서버 설정\nmail.setHost(\"smtp.gmail.com\");\nmail.setPort(587);\nmail.setSSL(true);\n\n// 인증 정보\nmail.setAuth(\"your-email@gmail.com\", \"your-app-password\");\n\n// 발신자 설정\nmail.setMailFrom(\"your-email@gmail.com\");\n\n// 인코딩 설정 (기본: utf-8)\nmail.setEncoding(\"utf-8\");\n\n// 이메일 발송\nmail.send(\"recipient@example.com\", \"제목\", \"내용\");\n```\n\n---\n\n## 베스트 프랙티스\n\n### 1. 예외 처리\n\n```jsp\ntry {\n    Gmail mail = new Gmail();\n    mail.send(\"user@example.com\", \"제목\", \"내용\");\n    m.p(\"이메일 발송 성공\");\n} catch(Exception e) {\n    m.p(\"이메일 발송 실패: \" + e.getMessage());\n    Malgn.errorLog(\"Email send error\", e);\n}\n```\n\n### 2. 이메일 주소 검증\n\n```jsp\nString email = f.get(\"email\");\n\n// Form 클래스로 검증\nf.addElement(\"email\", null, \"type:'email', required:'Y'\");\n\n// 또는 정규표현식으로 검증\nif(!email.matches(\"^[A-Za-z0-9+_.-]+@(.+)$\")) {\n    m.jsError(\"올바른 이메일 주소를 입력하세요.\");\n    return;\n}\n```\n\n### 3. 대량 발송 시 지연\n\n```jsp\nUserDao user = new UserDao();\nDataSet userList = user.find(\"email_agree = 'Y'\");\n\nGmail mail = new Gmail();\nint count = 0;\n\nwhile(userList.next()) {\n    String email = userList.s(\"email\");\n\n    try {\n        mail.send(email, \"제목\", \"내용\");\n        count++;\n\n        // 100건마다 5초 대기 (SMTP 서버 부하 방지)\n        if(count % 100 == 0) {\n            Thread.sleep(5000);\n        }\n\n    } catch(Exception e) {\n        Malgn.errorLog(\"Email send error: \" + email, e);\n    }\n}\n\nm.p(\"총 \" + count + \"건 발송 완료\");\n```\n\n---\n\n## 참고 문서\n\n- [환경설정 및 캐시](configuration.md)\n- [파일 업로드 및 다운로드](file-upload-download.md)\n- [템플릿 - 이메일 템플릿](template.md)\n\n---\n\n[← 목차로 돌아가기](README.md)",
  "sections": [
    { "heading": "개요", "content": "Gmail 클래스를 통한 이메일 발송, Gmail/네이버/AWS SES 등 다양한 SMTP 서버 지원, 파일 첨부, HTML 이메일, 여러 수신자 기능을 제공합니다." },
    { "heading": "기본 이메일 발송", "content": "m.mail()을 사용한 가장 간단한 발송과 Gmail 클래스를 사용한 기본 발송 방법입니다." },
    { "heading": "Gmail 계정 사용", "content": "Gmail 앱 비밀번호 발급과 Gmail SMTP를 통한 이메일 발송 방법입니다." },
    { "heading": "네이버 메일 사용", "content": "네이버 메일 SMTP(smtp.naver.com)를 통한 이메일 발송 방법입니다." },
    { "heading": "AWS SES 사용", "content": "Amazon Simple Email Service를 통한 대량 이메일 발송 방법입니다." },
    { "heading": "파일 첨부", "content": "단일/여러 파일 첨부와 업로드된 파일 첨부 방법입니다." },
    { "heading": "HTML 이메일", "content": "HTML 본문 작성과 Page 템플릿을 사용한 HTML 이메일 발송 방법입니다." },
    { "heading": "여러 수신자", "content": "여러 명에게 발송, DB 조회 발송, 개별 발송(개인화), 대량 발송(m.mailer() 백그라운드 스레드) 방법입니다." },
    { "heading": "환경설정", "content": "config.xml의 SMTP 설정과 수동 설정 방법입니다." },
    { "heading": "베스트 프랙티스", "content": "예외 처리, 이메일 주소 검증, 대량 발송 시 지연, 비동기 발송, 로깅 등의 모범 사례입니다." }
  ],
  "related_docs": ["file-upload-download", "excel"],
  "related_classes": ["Gmail", "Malgn", "Form", "Page", "DataSet"]
}

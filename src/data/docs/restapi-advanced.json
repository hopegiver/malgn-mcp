{
  "slug": "restapi-advanced",
  "title": "REST API - 고급 라우팅",
  "category": "web",
  "content": "# REST API - 고급 라우팅\n\nPath Parameter를 활용한 고급 라우팅 패턴과 RESTful API 설계입니다.\n\n---\n\n## Path Parameter 기본\n\nPath Parameter를 사용하면 URL 경로에서 값을 추출할 수 있습니다.\n\n### 기본 사용법\n\n```jsp\n<%@ include file=\"/api/init.jsp\" %><%\n\n// GET /api/user/:id - 단일 조회\napi.get(\"/:id\", () -> {\n    int id = api.paramInt(\"id\");  // /api/user/123 → id=123\n\n    UserDao user = new UserDao();\n    DataSet info = user.get(id);\n\n    if(info.next()) {\n        j.success(info);\n    } else {\n        j.error(\"NOT_FOUND\", \"사용자를 찾을 수 없습니다.\");\n    }\n});\n\n%>\n```\n\n---\n\n## 지원 패턴\n\n### 1. 고정 경로 (Fixed Path)\n\n```jsp\n// GET /api/user/list\napi.get(\"/list\", () -> {\n    int page = m.ri(\"page\", 1);\n    int size = m.ri(\"size\", 20);\n\n    UserDao user = new UserDao();\n    DataSet list = user.findWithPaging(page, size);\n    j.success(\"조회되었습니다.\", list);\n});\n\n// GET /api/user/active\napi.get(\"/active\", () -> {\n    UserDao user = new UserDao();\n    DataSet list = user.findByStatus(\"active\");\n    j.success(list);\n});\n\n// GET /api/user/search\napi.get(\"/search\", () -> {\n    String keyword = m.rs(\"keyword\");  // query string\n    UserDao user = new UserDao();\n    DataSet list = user.search(keyword);\n    j.success(list);\n});\n```\n\n---\n\n### 2. 단일 Parameter\n\n```jsp\n// GET /api/user/:id\napi.get(\"/:id\", () -> {\n    int id = api.paramInt(\"id\");  // /api/user/123 → id=123\n\n    UserDao user = new UserDao();\n    DataSet info = user.get(id);\n\n    if(info.next()) {\n        j.success(info);\n    } else {\n        j.error(\"NOT_FOUND\", \"사용자를 찾을 수 없습니다.\");\n    }\n});\n```\n\n---\n\n### 3. 복수 Parameter\n\n```jsp\n// GET /api/product/:category/:id\napi.get(\"/:category/:id\", () -> {\n    String category = api.param(\"category\");\n    int id = api.paramInt(\"id\");\n\n    // /api/product/food/123 → category=food, id=123\n\n    ProductDao product = new ProductDao();\n    DataSet info = product.get(id);\n\n    if(info.next() && category.equals(info.s(\"category\"))) {\n        j.success(info);\n    } else {\n        j.error(\"NOT_FOUND\", \"상품을 찾을 수 없습니다.\");\n    }\n});\n```\n\n---\n\n### 4. 혼합 사용 (고정 경로 + Parameter)\n\n```jsp\n// GET /api/post/:id/comments\napi.get(\"/:id/comments\", () -> {\n    int postId = api.paramInt(\"id\");\n\n    CommentDao comment = new CommentDao();\n    DataSet list = comment.findByPostId(postId);\n    j.success(list);\n});\n\n// GET /api/user/:id/orders\napi.get(\"/:id/orders\", () -> {\n    int userId = api.paramInt(\"id\");\n\n    OrderDao order = new OrderDao();\n    DataSet list = order.findByUserId(userId);\n    j.success(list);\n});\n\n// GET /api/user/:id/orders/:orderId\napi.get(\"/:id/orders/:orderId\", () -> {\n    int userId = api.paramInt(\"id\");\n    int orderId = api.paramInt(\"orderId\");\n\n    OrderDao order = new OrderDao();\n    DataSet info = order.getByUserAndOrder(userId, orderId);\n\n    if(info.next()) {\n        j.success(info);\n    } else {\n        j.error(\"NOT_FOUND\", \"주문을 찾을 수 없습니다.\");\n    }\n});\n```\n\n---\n\n## 매칭 우선순위\n\nRestAPI 클래스는 다음 순서로 경로를 매칭합니다:\n\n1. **고정 경로** 먼저 매칭 (예: `/list`, `/active`)\n2. **Path parameter** 패턴 매칭 (예: `/:id`)\n\n따라서 `/api/user/list`는 `/:id`보다 `/list`에 먼저 매칭됩니다.\n\n### 예시\n\n```jsp\n// 1. 고정 경로\napi.get(\"/list\", () -> {\n    // /api/user/list → 여기에 매칭됨\n});\n\napi.get(\"/active\", () -> {\n    // /api/user/active → 여기에 매칭됨\n});\n\n// 2. Path parameter\napi.get(\"/:id\", () -> {\n    // /api/user/123 → 여기에 매칭됨\n    // /api/user/list → 매칭 안됨 (위의 /list가 먼저 매칭됨)\n});\n```\n\n---\n\n## Parameter 추출 메소드\n\n| 메소드 | 반환 타입 | 설명 | 예시 |\n|--------|----------|------|------|\n| `api.param(name)` | String | 문자열로 반환 | `String category = api.param(\"category\");` |\n| `api.paramInt(name)` | int | 정수로 변환 (실패시 0) | `int id = api.paramInt(\"id\");` |\n\n### 사용 예시\n\n```jsp\napi.get(\"/:category/:id\", () -> {\n    // 문자열 parameter\n    String category = api.param(\"category\");\n\n    // 정수 parameter\n    int id = api.paramInt(\"id\");\n\n    // /api/product/electronics/123\n    // category = \"electronics\"\n    // id = 123\n});\n```\n\n---\n\n## Query String과 함께 사용\n\nPath parameter와 query string을 동시에 사용할 수 있습니다:\n\n```jsp\n// GET /api/user/123?includeOrders=true\napi.get(\"/:id\", () -> {\n    // Path parameter\n    int id = api.paramInt(\"id\");\n\n    // Query string\n    boolean includeOrders = m.rb(\"includeOrders\");\n\n    UserDao user = new UserDao();\n    DataSet info = user.get(id);\n\n    if(info.next()) {\n        j.put(\"user\", info);\n\n        // includeOrders가 true면 주문 목록도 포함\n        if(includeOrders) {\n            OrderDao order = new OrderDao();\n            DataSet orders = order.findByUserId(id);\n            j.put(\"orders\", orders);\n        }\n\n        j.success();\n    } else {\n        j.error(\"NOT_FOUND\", \"사용자를 찾을 수 없습니다.\");\n    }\n});\n```\n\n**클라이언트 호출:**\n```javascript\n// 기본 조회\nfetch('/api/user/123')\n\n// 주문 목록 포함\nfetch('/api/user/123?includeOrders=true')\n```\n\n---\n\n## RESTful 라우팅 예시\n\n### /api/product.jsp\n\n```jsp\n<%@ include file=\"/api/init.jsp\" %><%\n\napi.setBasePath(\"/api/product\");\n\n// GET /api/product - 전체 목록\napi.get(\"/\", () -> {\n    String keyword = m.rs(\"keyword\");\n    int page = m.ri(\"page\", 1);\n    int size = m.ri(\"size\", 20);\n\n    ProductDao product = new ProductDao();\n    DataSet list = product.find(keyword, page, size);\n    int total = product.getTotal();\n\n    j.put(\"products\", list);\n    j.put(\"total\", total);\n    j.put(\"page\", page);\n    j.put(\"size\", size);\n    j.success();\n});\n\n// GET /api/product/:category - 카테고리별 목록\napi.get(\"/:category\", () -> {\n    String category = api.param(\"category\");\n\n    ProductDao product = new ProductDao();\n    DataSet list = product.findByCategory(category);\n\n    j.put(\"products\", list);\n    j.put(\"category\", category);\n    j.success();\n});\n\n// GET /api/product/:category/:id - 특정 상품 조회\napi.get(\"/:category/:id\", () -> {\n    String category = api.param(\"category\");\n    int id = api.paramInt(\"id\");\n\n    ProductDao product = new ProductDao();\n    DataSet info = product.get(id);\n\n    if(info.next() && category.equals(info.s(\"category\"))) {\n        j.success(info);\n    } else {\n        j.error(\"NOT_FOUND\", \"상품을 찾을 수 없습니다.\");\n    }\n});\n\n// POST /api/product - 상품 생성\napi.post(\"/\", () -> {\n    ProductDao product = new ProductDao();\n    product.item(\"name\", f.get(\"name\"));\n    product.item(\"category\", f.get(\"category\"));\n    product.item(\"price\", f.getInt(\"price\"));\n    product.item(\"description\", f.get(\"description\"));\n\n    if(product.insert()) {\n        j.success(\"등록되었습니다.\", product.id);\n    } else {\n        j.error(\"DATABASE_ERROR\", product.getErrMsg());\n    }\n});\n\n// PUT /api/product/:id - 상품 수정\napi.put(\"/:id\", () -> {\n    int id = api.paramInt(\"id\");\n\n    ProductDao product = new ProductDao();\n    product.get(id);\n    product.item(\"name\", f.get(\"name\"));\n    product.item(\"category\", f.get(\"category\"));\n    product.item(\"price\", f.getInt(\"price\"));\n    product.item(\"description\", f.get(\"description\"));\n\n    if(product.update()) {\n        j.success(\"수정되었습니다.\");\n    } else {\n        j.error(\"DATABASE_ERROR\", product.getErrMsg());\n    }\n});\n\n// PATCH /api/product/:id - 부분 수정\napi.patch(\"/:id\", () -> {\n    int id = api.paramInt(\"id\");\n\n    ProductDao product = new ProductDao();\n    product.get(id);\n\n    // 전달된 필드만 업데이트\n    String name = f.get(\"name\");\n    if(!\"\".equals(name)) product.item(\"name\", name);\n\n    String category = f.get(\"category\");\n    if(!\"\".equals(category)) product.item(\"category\", category);\n\n    int price = f.getInt(\"price\");\n    if(price > 0) product.item(\"price\", price);\n\n    if(product.update()) {\n        j.success(\"수정되었습니다.\");\n    } else {\n        j.error(\"DATABASE_ERROR\", product.getErrMsg());\n    }\n});\n\n// DELETE /api/product/:id - 상품 삭제\napi.delete(\"/:id\", () -> {\n    int id = api.paramInt(\"id\");\n\n    ProductDao product = new ProductDao();\n    if(product.delete(id)) {\n        j.success(\"삭제되었습니다.\");\n    } else {\n        j.error(\"DATABASE_ERROR\", product.getErrMsg());\n    }\n});\n\n%>\n```\n\n---\n\n## 클라이언트 호출 예시\n\n```javascript\n// GET /api/product - 전체 목록\nfetch('/api/product')\n    .then(response => response.json())\n    .then(data => console.log(data));\n\n// GET /api/product?keyword=노트북&page=1&size=20 - 검색\nfetch('/api/product?keyword=노트북&page=1&size=20')\n    .then(response => response.json())\n    .then(data => console.log(data));\n\n// GET /api/product/electronics - 전자제품 카테고리\nfetch('/api/product/electronics')\n    .then(response => response.json())\n    .then(data => console.log(data));\n\n// GET /api/product/electronics/123 - 특정 상품\nfetch('/api/product/electronics/123')\n    .then(response => response.json())\n    .then(data => console.log(data));\n\n// POST /api/product - 상품 생성\nfetch('/api/product', {\n    method: 'POST',\n    headers: {\n        'Content-Type': 'application/x-www-form-urlencoded',\n    },\n    body: 'name=노트북&category=electronics&price=1000000&description=고성능 노트북'\n})\n    .then(response => response.json())\n    .then(data => console.log(data));\n\n// PUT /api/product/123 - 전체 수정\nfetch('/api/product/123', {\n    method: 'PUT',\n    headers: {\n        'Content-Type': 'application/x-www-form-urlencoded',\n    },\n    body: 'name=게이밍노트북&category=electronics&price=1500000&description=고성능 게이밍 노트북'\n})\n    .then(response => response.json())\n    .then(data => console.log(data));\n\n// PATCH /api/product/123 - 부분 수정 (가격만)\nfetch('/api/product/123', {\n    method: 'PATCH',\n    headers: {\n        'Content-Type': 'application/x-www-form-urlencoded',\n    },\n    body: 'price=1200000'\n})\n    .then(response => response.json())\n    .then(data => console.log(data));\n\n// DELETE /api/product/123 - 삭제\nfetch('/api/product/123', {\n    method: 'DELETE'\n})\n    .then(response => response.json())\n    .then(data => console.log(data));\n```\n\n---\n\n## 중첩 리소스 라우팅\n\n### /api/post.jsp\n\n```jsp\n<%@ include file=\"/api/init.jsp\" %><%\n\napi.setBasePath(\"/api/post\");\n\n// GET /api/post/:id/comments - 게시글의 댓글 목록\napi.get(\"/:id/comments\", () -> {\n    int postId = api.paramInt(\"id\");\n\n    CommentDao comment = new CommentDao();\n    DataSet list = comment.findByPostId(postId);\n\n    j.put(\"comments\", list);\n    j.put(\"post_id\", postId);\n    j.success();\n});\n\n// POST /api/post/:id/comments - 댓글 작성\napi.post(\"/:id/comments\", () -> {\n    int postId = api.paramInt(\"id\");\n    String content = f.get(\"content\");\n\n    CommentDao comment = new CommentDao();\n    comment.item(\"post_id\", postId);\n    comment.item(\"content\", content);\n    comment.item(\"user_id\", userId);  // init.jsp에서 설정\n\n    if(comment.insert()) {\n        j.success(\"댓글이 등록되었습니다.\", comment.id);\n    } else {\n        j.error(\"DATABASE_ERROR\", comment.getErrMsg());\n    }\n});\n\n// GET /api/post/:id/comments/:commentId - 특정 댓글 조회\napi.get(\"/:id/comments/:commentId\", () -> {\n    int postId = api.paramInt(\"id\");\n    int commentId = api.paramInt(\"commentId\");\n\n    CommentDao comment = new CommentDao();\n    DataSet info = comment.get(commentId);\n\n    if(info.next() && postId == info.i(\"post_id\")) {\n        j.success(info);\n    } else {\n        j.error(\"NOT_FOUND\", \"댓글을 찾을 수 없습니다.\");\n    }\n});\n\n// DELETE /api/post/:id/comments/:commentId - 댓글 삭제\napi.delete(\"/:id/comments/:commentId\", () -> {\n    int postId = api.paramInt(\"id\");\n    int commentId = api.paramInt(\"commentId\");\n\n    CommentDao comment = new CommentDao();\n    DataSet info = comment.get(commentId);\n\n    // 권한 체크: 작성자만 삭제 가능\n    if(info.next() && info.i(\"user_id\") == userId) {\n        if(comment.delete(commentId)) {\n            j.success(\"삭제되었습니다.\");\n        } else {\n            j.error(\"DATABASE_ERROR\", comment.getErrMsg());\n        }\n    } else {\n        j.error(\"FORBIDDEN\", \"권한이 없습니다.\");\n    }\n});\n\n%>\n```\n\n---\n\n## 관련 문서\n\n- [REST API 개발](restapi.md) - REST API 기본 가이드\n- [JWT 인증](restapi-jwt.md) - JWT 인증 가이드\n- [CORS 설정](restapi-cors.md) - CORS 설정 가이드\n- [응답 표준](restapi-response.md) - 에러/성공 응답 표준\n\n---\n\n[← 목차로 돌아가기](README.md)",
  "sections": [
    {
      "heading": "Path Parameter 기본",
      "content": "Path Parameter를 사용하면 URL 경로에서 값을 추출할 수 있습니다. api.paramInt(\"id\")로 정수, api.param(\"name\")으로 문자열을 추출합니다."
    },
    {
      "heading": "지원 패턴",
      "content": "고정 경로(Fixed Path), 단일 Parameter, 복수 Parameter, 혼합 사용(고정 경로 + Parameter) 4가지 패턴을 지원합니다."
    },
    {
      "heading": "매칭 우선순위",
      "content": "고정 경로가 먼저 매칭되고, 그 다음 Path parameter 패턴이 매칭됩니다. /api/user/list는 /:id보다 /list에 먼저 매칭됩니다."
    },
    {
      "heading": "Parameter 추출 메소드",
      "content": "api.param(name)은 String 반환, api.paramInt(name)은 int 반환(실패시 0)합니다."
    },
    {
      "heading": "Query String과 함께 사용",
      "content": "Path parameter와 query string을 동시에 사용할 수 있습니다. 예: /api/user/123?includeOrders=true"
    },
    {
      "heading": "RESTful 라우팅 예시",
      "content": "/api/product.jsp를 사용한 완전한 RESTful CRUD 라우팅 예시입니다."
    },
    {
      "heading": "클라이언트 호출 예시",
      "content": "JavaScript fetch API를 사용한 다양한 HTTP 메소드 호출 예시입니다."
    },
    {
      "heading": "중첩 리소스 라우팅",
      "content": "/api/post/:id/comments 패턴으로 중첩 리소스를 라우팅하는 방법입니다."
    },
    {
      "heading": "관련 문서",
      "content": "REST API 기본 가이드, JWT 인증, CORS 설정, 응답 표준 등의 관련 문서 목록입니다."
    }
  ],
  "related_docs": ["restapi", "restapi-jwt", "restapi-cors", "restapi-response"],
  "related_classes": ["RestAPI", "Malgn", "Form", "Json", "DataSet"]
}

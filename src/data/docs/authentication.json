{
  "slug": "authentication",
  "title": "인증 처리",
  "category": "security",
  "content": "# 인증 처리\n\n[← 목차로 돌아가기](README.md)\n\n---\n\n## 인증 시스템 개요\n\n맑은프레임워크는 **세션 및 쿠키 기반**의 강력한 인증 시스템을 제공합니다.\n\n### 핵심 개념\n\n**Auth 클래스는 init.jsp에서 주로 사용됩니다:**\n\n1. **객체 생성 후 `isValid()` 호출**: 인증 데이터 검증\n2. **검증 성공 시**: 전역 변수(userId, userName 등) 설정\n3. **세부 페이지에서**: `userId == 0` 또는 `userId == null`로 로그인 상태 확인\n\n### 주요 클래스\n\n- **Auth 클래스**: 인증 정보 저장/조회/검증\n- **Malgn 클래스 (m)**: 세션/쿠키 관리 메소드\n\n---\n\n## init.jsp에서 인증 처리 패턴\n\n**init.jsp에서 Auth 객체를 생성하고 전역 변수를 설정하는 것이 핵심입니다:**\n\n```jsp\n<%@ page contentType=\"text/html; charset=utf-8\" %><%@ page import=\"java.util.*, java.io.*, dao.*, malgnsoft.db.*, malgnsoft.util.*\" %><%\n\nMalgn m = new Malgn(request, response, out);\n\nForm f = new Form();\nf.setRequest(request);\n\nPage p = new Page();\np.setRequest(request);\np.setWriter(out);\np.setPageContext(pageContext);\n\n// Auth 객체 생성\nAuth auth = new Auth(request, response);\n\n// 전역 변수 초기화\nint userId = 0;\nString userName = null;\nint userLevel = 0;\n\n// 인증 데이터 검증\nif(auth.isValid()) {\n    // 인증 성공: 사이트 전체에서 사용할 변수 설정\n    userId = auth.getInt(\"user_id\");\n    userName = auth.getString(\"user_name\");\n    userLevel = auth.getInt(\"user_level\");\n}\n\n// 템플릿에서 사용할 수 있도록 설정\np.setVar(\"userId\", userId);\np.setVar(\"userName\", userName);\np.setVar(\"userLevel\", userLevel);\n\n%>\n```\n\n**세부 페이지에서 로그인 체크:**\n\n```jsp\n<%@ page contentType=\"text/html; charset=utf-8\" %><%@ include file=\"/init.jsp\" %><%\n\n// userId가 0이면 로그인 안된 상태\nif(userId == 0) {\n    m.jsAlert(\"로그인이 필요합니다.\");\n    m.jsReplace(\"/main/login.jsp\");\n    return;\n}\n\n// 로그인된 사용자 처리\nm.p(\"환영합니다, \" + userName + \"님!\");\n\n%>\n```\n\n---\n\n## Auth 클래스\n\n### 기본 개념\n\nAuth 클래스는 로그인 사용자 정보를 **암호화하여** 세션 또는 쿠키에 저장합니다.\n\n```jsp\nAuth auth = new Auth(request, response);\n```\n\n### 주요 메소드\n\n| 메소드 | 설명 |\n|--------|------|\n| isValid() | 인증 데이터 검증 (init.jsp에서 사용) |\n| put(key, value) | 인증 정보 추가 |\n| save() | 세션/쿠키에 저장 |\n| getInt(key) | 정수 값 가져오기 |\n| getString(key) | 문자열 값 가져오기 |\n| delete() | 인증 정보 삭제 (로그아웃) |\n| loginForm() | 로그인 페이지로 리다이렉트 |\n\n### Auth 설정 옵션\n\nAuth 클래스는 다양한 설정을 지원합니다:\n\n| 설정 메소드 | 기본값 | 설명 |\n|------------|--------|------|\n| setKeyName(String) | \"AUTHID\" | 세션/쿠키 키 이름 |\n| setLoginURL(String) | \"../member/login.jsp\" | 로그인 페이지 URL |\n| setPath(String) | \"/\" | 쿠키 경로 |\n| setDomain(String) | null | 쿠키 도메인 (.example.com) |\n| setSecure(boolean) | false | HTTPS에서만 쿠키 전송 |\n| setHttpOnly(boolean) | false | JavaScript에서 쿠키 접근 차단 |\n| setSameSite(String) | null | SameSite 속성 (Strict/Lax/None) |\n| setValidTime(int) | -1 | 인증 유효 시간 (초), -1이면 무제한 |\n| setMaxAge(int) | -1 | 쿠키 유효 기간 (초), -1이면 브라우저 종료 시 삭제 |\n\n**설정 예시:**\n\n```jsp\nAuth auth = new Auth(request, response);\nauth.setKeyName(\"MY_AUTH\");\nauth.setLoginURL(\"/member/login.jsp\");\nauth.setSecure(true);  // HTTPS 전용\nauth.setHttpOnly(true);  // XSS 방지\nauth.setSameSite(\"Strict\");  // CSRF 방지\nauth.setValidTime(3600);  // 1시간 후 재인증 필요\nauth.setMaxAge(86400);  // 쿠키 24시간 유지\n```\n\n---\n\n## 로그인 구현\n\n### 기본 로그인 예제\n\n```jsp\n<%@ page contentType=\"text/html; charset=utf-8\" %><%@ include file=\"/init.jsp\" %><%\n\nf.addElement(\"id\", null, \"title:'아이디', required:'Y'\");\nf.addElement(\"passwd\", null, \"title:'비밀번호', required:'Y'\");\n\nif(m.isPost() && f.validate()) {\n\n    String id = f.get(\"id\");\n    String passwd = f.get(\"passwd\");\n\n    // 데이터베이스에서 사용자 확인\n    UserDao user = new UserDao();\n    DataSet userInfo = user.query(\"WHERE user_id = ? AND passwd = ?\", new Object[]{id, Malgn.sha256(passwd)});\n\n    if(userInfo.next()) {\n        // 로그인 성공 - 인증 정보 저장\n        auth.put(\"user_id\", userInfo.getInt(\"id\"));\n        auth.put(\"user_name\", user.getString(\"name\"));\n        auth.put(\"user_level\", userInfo.getInt(\"level\"));\n        auth.save();\n\n        m.jsAlert(\"로그인 성공\");\n        m.jsReplace(\"/main/index.jsp\");\n    } else {\n        // 로그인 실패\n        m.jsError(\"아이디 또는 비밀번호가 올바르지 않습니다.\");\n    }\n    return;\n}\n\np.setBody(\"main.login\");\np.setVar(\"form_script\", f.getScript());\np.display();\n\n%>\n```\n\n---\n\n## 로그아웃 구현\n\n### 기본 로그아웃\n\n```jsp\n<%@ page contentType=\"text/html; charset=utf-8\" %><%@ include file=\"/init.jsp\" %><%\n\n// 인증 정보 삭제\nauth.delete();\n\nm.jsAlert(\"로그아웃되었습니다.\");\nm.jsReplace(\"/main/login.jsp\");\n\n%>\n```\n\n---\n\n## 로그인 체크\n\n### 페이지별 로그인 체크\n\n```jsp\n<%@ page contentType=\"text/html; charset=utf-8\" %><%@ include file=\"/init.jsp\" %><%\n\n// 로그인 체크 (userId는 init.jsp에서 설정됨)\nif(userId == 0) {\n    m.jsAlert(\"로그인이 필요합니다.\");\n    m.jsReplace(\"/main/login.jsp\");\n    return;\n}\n\n// 로그인한 사용자 정보 사용\nm.p(\"로그인 사용자: \" + userName + \" (ID: \" + userId + \")\");\n\n%>\n```\n\n### 권한 레벨 체크\n\n```jsp\n// 관리자 권한 체크 (userLevel은 init.jsp에서 설정됨)\nif(userLevel < 10) {\n    m.jsError(\"관리자만 접근할 수 있습니다.\");\n    return;\n}\n```\n\n---\n\n## 세션 관리\n\n### 세션 값 설정\n\n```jsp\nm.setSession(\"user_name\", \"홍길동\");\nm.setSession(\"user_level\", 5);\n```\n\n### 세션 값 가져오기\n\n```jsp\nString userName = m.getSession(\"user_name\");\nint userLevel = m.getSessionInt(\"user_level\");\n```\n\n### 세션 값 삭제\n\n```jsp\nm.removeSession(\"user_name\");\nsession.invalidate();\n```\n\n---\n\n## 쿠키 관리\n\n### 쿠키 설정\n\n```jsp\nm.setCookie(\"remember_id\", \"user001\");\nm.setCookie(\"remember_id\", \"user001\", 60 * 60 * 24 * 7);\n```\n\n### 쿠키 읽기\n\n```jsp\nString rememberId = m.getCookie(\"remember_id\");\n```\n\n### 쿠키 삭제\n\n```jsp\nm.setCookie(\"remember_id\", \"\", 0);\n```\n\n---\n\n## 비밀번호 암호화\n\n### SHA-256 해시\n\n```jsp\nString plainPassword = f.get(\"passwd\");\nString hashedPassword = Malgn.sha256(plainPassword);\n```\n\n### 다양한 해시 알고리즘\n\n```jsp\nString md5 = Malgn.md5(\"password\");\nString sha1 = Malgn.sha1(\"password\");\nString sha256 = Malgn.sha256(\"password\");\nString sha512 = Malgn.sha512(\"password\");\n```\n\n---\n\n## 보안 고려사항\n\n1. HTTPS 사용\n2. 비밀번호 정책\n3. SQL Injection 방지\n4. XSS 방지\n\n---\n\n## 주요 메소드 정리\n\n### Auth 클래스\n\n| 메소드 | 설명 |\n|--------|------|\n| put(key, value) | 인증 정보 추가 |\n| save() | 세션에 저장 |\n| get(key) | 값 가져오기 |\n| getInt(key) | 정수로 가져오기 |\n| getString(key) | 문자열로 가져오기 |\n| clear() | 인증 정보 삭제 |\n| isLogin() | 로그인 여부 |\n\n### 세션/쿠키 메소드 (Malgn)\n\n| 메소드 | 설명 |\n|--------|------|\n| setSession(key, value) | 세션 값 설정 |\n| getSession(key) | 세션 값 가져오기 |\n| getSessionInt(key) | 세션 정수 가져오기 |\n| removeSession(key) | 세션 값 삭제 |\n| setCookie(name, value) | 쿠키 설정 |\n| setCookie(name, value, age) | 쿠키 설정 (유효기간) |\n| getCookie(name) | 쿠키 값 가져오기 |\n\n---\n\n[← 이전: Excel 처리](excel.md) | [목차로 돌아가기](README.md) | [다음: 환경 설정 →](configuration.md)",
  "sections": [
    { "heading": "인증 시스템 개요", "content": "세션 및 쿠키 기반의 인증 시스템으로, Auth 클래스와 Malgn 클래스를 사용합니다." },
    { "heading": "init.jsp에서 인증 처리 패턴", "content": "init.jsp에서 Auth 객체를 생성하고 전역 변수를 설정하는 핵심 패턴입니다." },
    { "heading": "Auth 클래스", "content": "Auth 클래스의 주요 메소드, 설정 옵션(키 이름, 로그인 URL, 쿠키 설정, 유효 시간 등)을 설명합니다." },
    { "heading": "로그인 구현", "content": "Form 클래스를 사용한 로그인 폼 처리와 SHA-256 비밀번호 검증 예제입니다." },
    { "heading": "로그아웃 구현", "content": "auth.delete()를 사용한 로그아웃 구현입니다." },
    { "heading": "로그인 체크", "content": "페이지별 로그인 체크와 권한 레벨 체크 방법입니다." },
    { "heading": "세션 관리", "content": "세션 값의 설정, 가져오기, 삭제 방법입니다." },
    { "heading": "쿠키 관리", "content": "쿠키의 설정, 읽기, 삭제 방법입니다." },
    { "heading": "비밀번호 암호화", "content": "SHA-256, MD5, SHA-1, SHA-512 등의 해시 알고리즘을 사용한 비밀번호 암호화입니다." },
    { "heading": "보안 고려사항", "content": "HTTPS 사용, 비밀번호 정책, SQL Injection 방지, XSS 방지 등의 보안 고려사항입니다." },
    { "heading": "주요 메소드 정리", "content": "Auth 클래스와 Malgn 클래스의 세션/쿠키 메소드 정리입니다." }
  ],
  "related_docs": ["encryption", "restapi-jwt", "oauth", "restapi"],
  "related_classes": ["Auth", "Malgn", "Form", "Page", "DataSet"]
}

{
  "slug": "excel",
  "title": "Excel 처리",
  "category": "util",
  "content": "# 10. Excel 처리\n\n[← 목차로 돌아가기](README.md)\n\n---\n\n## Excel 클래스 개요\n\nMalgnFramework는 Excel 파일을 읽고 쓰기 위한 세 가지 클래스를 제공합니다.\n\n### 지원 클래스\n\n| 클래스 | 파일 형식 | 용도 |\n|--------|----------|------|\n| ExcelReader | .xls (Excel 97-2003) | 읽기 전용 |\n| ExcelWriter | .xls (Excel 97-2003) | 쓰기 전용 |\n| ExcelX | .xlsx (Excel 2007+) | 읽기/쓰기 |\n\n---\n\n## ExcelReader - Excel 읽기 (.xls)\n\n### 기본 사용법\n\n```jsp\n<%@ page contentType=\"text/html; charset=utf-8\" %><%@ include file=\"/init.jsp\" %><%\n\nExcelReader excel = new ExcelReader(Config.getDataDir() + \"/sample.xls\");\n\n// 시트 선택 (0부터 시작)\nexcel.setSheet(0);\n\n// DataSet으로 읽기\nDataSet data = excel.getDataSet();\n\n// 데이터 출력\nwhile(data.next()) {\n    m.p(data.getString(\"col0\"));  // 첫 번째 열\n    m.p(data.getString(\"col1\"));  // 두 번째 열\n    m.p(data.getString(\"col2\"));  // 세 번째 열\n}\n\nexcel.close();\n\n%>\n```\n\n### 여러 시트 읽기\n\n```jsp\n<%@ page contentType=\"text/html; charset=utf-8\" %><%@ include file=\"/init.jsp\" %><%\n\nExcelReader excel = new ExcelReader(Config.getDataDir() + \"/sample.xls\");\n\nint sheetCount = excel.getSheetCount();\nm.p(\"총 \" + sheetCount + \"개의 시트\");\n\nfor(int i = 0; i < sheetCount; i++) {\n    excel.setSheet(i);\n    String sheetName = excel.getSheetName(i);\n    m.p(\"시트 이름: \" + sheetName);\n\n    DataSet data = excel.getDataSet();\n    m.p(\"행 개수: \" + data.size());\n    m.p(data);\n}\n\nexcel.close();\n\n%>\n```\n\n---\n\n## ExcelX - Excel 읽기/쓰기 (.xlsx)\n\n### Excel 읽기\n\n```jsp\n<%@ page contentType=\"text/html; charset=utf-8\" %><%@ include file=\"/init.jsp\" %><%\n\nExcelX excel = new ExcelX();\n\n// 파일 읽기\nDataSet data = excel.read(Config.getDataDir() + \"/sample.xlsx\");\n\n// 데이터 검증\ndata.setCol(\"col0\", \"maxlength:12, type:datetime, length:9\");\ndata.setCol(\"col5\", \"type:number, length:3\");\n\nif(data.validate()) {\n    m.p(\"검증 성공\");\n} else {\n    m.p(\"검증 실패\");\n}\n\n// 데이터 출력\nwhile(data.next()) {\n    m.p(data.getString(\"col0\"));\n    m.p(data.getString(\"col1\"));\n}\n\n%>\n```\n\n### Excel 쓰기 (단일 시트)\n\n```jsp\n<%@ page contentType=\"text/html; charset=utf-8\" %><%@ include file=\"/init.jsp\" %><%\n\n// 데이터 준비\nDataSet data = new DataSet();\ndata.addRow();\ndata.put(\"col0\", \"user001\");\ndata.put(\"col1\", \"홍길동\");\ndata.put(\"col2\", \"hong@example.com\");\ndata.put(\"col3\", \"010-1234-5678\");\n\ndata.addRow();\ndata.put(\"col0\", \"user002\");\ndata.put(\"col1\", \"김철수\");\ndata.put(\"col2\", \"kim@example.com\");\ndata.put(\"col3\", \"010-2345-6789\");\n\n// Excel 생성\nExcelX excel = new ExcelX();\n\n// 컬럼 정의 (col이름=>헤더명)\nString[] columns = {\"col0=>아이디\", \"col1=>이름\", \"col2=>이메일\", \"col3=>전화번호\"};\n\nexcel.setSheet(\"회원정보\");\nexcel.setData(data, columns);\n\n// 파일로 저장\nexcel.write(Config.getDataDir() + \"/users.xlsx\");\n\n// 또는 다운로드로 전송\n// excel.write(response, \"회원정보.xlsx\");\n\n%>\n```\n\n### Excel 쓰기 (다중 시트)\n\n```jsp\n<%@ page contentType=\"text/html; charset=utf-8\" %><%@ include file=\"/init.jsp\" %><%\n\nExcelX excel = new ExcelX();\n\n// 첫 번째 시트 - 회원 정보\nDataSet userList = new DataSet();\nuserList.addRow();\nuserList.put(\"col0\", \"user001\");\nuserList.put(\"col1\", \"홍길동\");\nuserList.put(\"col2\", \"hong@example.com\");\n\nuserList.addRow();\nuserList.put(\"col0\", \"user002\");\nuserList.put(\"col1\", \"김철수\");\nuserList.put(\"col2\", \"kim@example.com\");\n\nString[] userColumns = {\"col0=>아이디\", \"col1=>이름\", \"col2=>이메일\"};\nexcel.setSheet(\"회원정보\");\nexcel.setData(userList, userColumns);\n\n// 두 번째 시트 - 주문 정보\nDataSet orderList = new DataSet();\norderList.addRow();\norderList.put(\"col0\", \"20250101\");\norderList.put(\"col1\", \"ORD001\");\norderList.put(\"col2\", \"50000\");\n\norderList.addRow();\norderList.put(\"col0\", \"20250102\");\norderList.put(\"col1\", \"ORD002\");\norderList.put(\"col2\", \"35000\");\n\nString[] orderColumns = {\"col0=>주문일\", \"col1=>주문번호\", \"col2=>금액\"};\nexcel.setSheet(\"주문내역\");\nexcel.setData(orderList, orderColumns);\n\n// 다운로드\nexcel.write(response, \"보고서.xlsx\");\n\n%>\n```\n\n### 비밀번호로 보호\n\n```jsp\nExcelX excel = new ExcelX();\nexcel.setSheet(\"민감정보\");\nexcel.setData(data, columns);\n\n// 비밀번호 설정\nexcel.setPassword(\"1234\");\n\nexcel.write(response, \"보호문서.xlsx\");\n```\n\n---\n\n## 실전 예제\n\n### 1. 데이터베이스 조회 결과를 Excel로\n\n```jsp\n<%@ page contentType=\"text/html; charset=utf-8\" %><%@ include file=\"/init.jsp\" %><%\n\n// 데이터베이스 조회\nUserDao user = new UserDao();\nDataSet userList = user.query(\"WHERE status = 1 ORDER BY reg_date DESC\");\n\n// Excel 생성\nExcelX excel = new ExcelX();\n\nString[] columns = {\n    \"id=>번호\",\n    \"user_id=>아이디\",\n    \"name=>이름\",\n    \"email=>이메일\",\n    \"phone=>전화번호\",\n    \"reg_date=>가입일\"\n};\n\nexcel.setSheet(\"회원목록\");\nexcel.setData(userList, columns);\n\n// 다운로드\nexcel.write(response, \"회원목록_\" + m.time(\"yyyyMMdd\") + \".xlsx\");\n\n%>\n```\n\n### 2. Excel 업로드 및 일괄 처리\n\n```jsp\n<%@ page contentType=\"text/html; charset=utf-8\" %><%@ include file=\"/init.jsp\" %><%\n\nf.addElement(\"excel_file\", null, \"required:Y, accept:'.xlsx'\");\n\nif(m.isPost() && f.validate()) {\n\n    String filePath = f.getFileDir(\"excel_file\") + \"/\" + f.getFileName(\"excel_file\");\n\n    // Excel 읽기\n    ExcelX excel = new ExcelX();\n    DataSet data = excel.read(filePath);\n\n    // 데이터 검증\n    data.setCol(\"col0\", \"required:Y, maxlength:50\");  // 아이디\n    data.setCol(\"col1\", \"required:Y\");  // 이름\n    data.setCol(\"col2\", \"type:email\");  // 이메일\n\n    if(!data.validate()) {\n        m.jsError(\"Excel 데이터 검증 실패\");\n        return;\n    }\n\n    // 데이터베이스에 일괄 저장\n    UserDao user = new UserDao();\n    int successCount = 0;\n\n    data.first();\n    while(data.next()) {\n        user.item(\"user_id\", data.getString(\"col0\"));\n        user.item(\"name\", data.getString(\"col1\"));\n        user.item(\"email\", data.getString(\"col2\"));\n        user.item(\"reg_date\", m.time());\n\n        if(user.insert()) {\n            successCount++;\n        } else {\n            m.p(\"오류: \" + user.getErrMsg());\n        }\n        user.clear();\n    }\n\n    m.jsAlert(successCount + \"명의 회원이 등록되었습니다.\");\n    m.jsReplace(\"list.jsp\");\n    return;\n}\n\np.setBody(\"main.upload_excel\");\np.setVar(\"form_script\", f.getScript());\np.display();\n\n%>\n```\n\n### 3. 검색 결과를 Excel로 다운로드\n\n```jsp\n<%@ page contentType=\"text/html; charset=utf-8\" %><%@ include file=\"/init.jsp\" %><%\n\nString mode = m.rs(\"mode\");\n\nif(\"download\".equals(mode)) {\n\n    // 검색 조건으로 데이터 조회 (페이징 없으므로 DataObject 사용)\n    BlogDao blog = new BlogDao();\n    blog.addSearch(\"subject,content\", f.get(\"keyword\"), \"LIKE\");\n\n    int status = f.getInt(\"status\", -1);\n    if(status >= 0) {\n        blog.addSearch(\"status\", status);\n    }\n\n    blog.setOrderBy(\"id DESC\");\n    DataSet list = blog.find();\n\n    // Excel 생성\n    ExcelX excel = new ExcelX();\n\n    String[] columns = {\n        \"id=>번호\",\n        \"subject=>제목\",\n        \"name=>작성자\",\n        \"reg_date=>작성일\",\n        \"hit=>조회수\"\n    };\n\n    list.first();\n    excel.setSheet(\"게시물목록\");\n    excel.setData(list, columns);\n\n    excel.write(response, \"게시물목록_\" + m.time(\"yyyyMMdd\") + \".xlsx\");\n    return;\n}\n\n// 일반 목록 화면 (페이징이 필요하므로 ListManager 사용)\nListManager lm = new ListManager();\nlm.setRequest(request);\nlm.setTable(\"tb_blog\");\nlm.setListNum(20);\nlm.addSearch(\"subject,content\", f.get(\"keyword\"), \"LIKE\");\n\nDataSet list = lm.getDataSet();\n\np.setBody(\"main.blog_list\");\np.setLoop(\"list\", list);\np.setVar(\"pager\", lm.getPaging());\np.display();\n\n%>\n```\n\n**HTML 템플릿에 다운로드 버튼 추가**:\n```html\n<a href=\"list.jsp?mode=download&keyword={{keyword}}\" class=\"btn\">Excel 다운로드</a>\n```\n\n### 4. 월별 통계 Excel 생성\n\n```jsp\n<%@ page contentType=\"text/html; charset=utf-8\" %><%@ include file=\"/init.jsp\" %><%\n\n// 월별 집계 데이터 조회\nDataObject dao = new DataObject();\nDataSet list = dao.queryDataSet(\n    \"SELECT \" +\n    \"  DATE_FORMAT(reg_date, '%Y-%m') AS month, \" +\n    \"  COUNT(*) AS cnt, \" +\n    \"  SUM(amount) AS total \" +\n    \"FROM tb_order \" +\n    \"WHERE reg_date >= '2025-01-01' \" +\n    \"GROUP BY DATE_FORMAT(reg_date, '%Y-%m') \" +\n    \"ORDER BY month DESC\"\n);\n\n// Excel 생성\nExcelX excel = new ExcelX();\n\nString[] columns = {\n    \"month=>월\",\n    \"cnt=>주문건수\",\n    \"total=>매출합계\"\n};\n\nexcel.setSheet(\"월별통계\");\nexcel.setData(list, columns);\n\nexcel.write(response, \"월별통계_\" + m.time(\"yyyyMMdd\") + \".xlsx\");\n\n%>\n```\n\n---\n\n## 디버깅\n\n### ExcelReader 디버깅\n\n```jsp\nExcelReader excel = new ExcelReader(Config.getDataDir() + \"/sample.xls\");\nexcel.setDebug(out);  // 디버그 정보 출력\n```\n\n### ExcelX 디버깅\n\n```jsp\nExcelX excel = new ExcelX();\nexcel.setDebug(out);  // 디버그 정보 출력\n```\n\n**출력 내용**:\n- 파일 경로\n- 시트 정보\n- 컬럼 매핑\n- 처리 시간\n\n---\n\n## 성능 최적화\n\n### 대용량 파일 처리\n\n```jsp\n<%@ page contentType=\"text/html; charset=utf-8\" %><%@ include file=\"/init.jsp\" %><%\n\nExcelReader excel = new ExcelReader(Config.getDataDir() + \"/large_file.xls\");\n\nlong start = System.currentTimeMillis();\n\nexcel.setSheet(0);\nDataSet data = excel.getDataSet();\n\nlong end = System.currentTimeMillis();\nm.p(\"처리 시간: \" + (end - start) + \"ms\");\nm.p(\"행 개수: \" + data.size());\n\nexcel.close();\n\n%>\n```\n\n### 메모리 관리\n\n```jsp\n// 사용 후 반드시 닫기\nExcelReader excel = new ExcelReader(filePath);\ntry {\n    DataSet data = excel.getDataSet();\n    // 처리...\n} finally {\n    excel.close();  // 메모리 해제\n}\n```\n\n---\n\n## 주요 메소드 정리\n\n### ExcelReader (.xls 읽기)\n\n| 메소드 | 설명 |\n|--------|------|\n| ExcelReader(filePath) | Excel 파일 로드 |\n| getSheetCount() | 시트 개수 |\n| getSheetName(index) | 시트 이름 |\n| setSheet(index) | 시트 선택 (0부터 시작) |\n| getDataSet() | 현재 시트를 DataSet으로 |\n| setDebug(out) | 디버깅 모드 |\n| close() | 리소스 해제 |\n\n### ExcelX (.xlsx 읽기/쓰기)\n\n| 메소드 | 설명 |\n|--------|------|\n| ExcelX() | 생성자 |\n| read(filePath) | Excel 파일 읽기 → DataSet |\n| setSheet(name) | 시트 이름 설정 |\n| setData(dataSet, columns) | 데이터 및 컬럼 설정 |\n| setPassword(password) | 비밀번호 설정 |\n| write(filePath) | 파일로 저장 |\n| write(response, fileName) | 다운로드로 전송 |\n| setDebug(out) | 디버깅 모드 |\n\n### 컬럼 정의 형식\n\n```jsp\nString[] columns = {\n    \"col0=>헤더1\",  // col0을 \"헤더1\"로 표시\n    \"col1=>헤더2\",  // col1을 \"헤더2\"로 표시\n    \"col2=>헤더3\"   // col2를 \"헤더3\"로 표시\n};\n```\n\n---\n\n## 베스트 프랙티스\n\n### 1. 파일 형식 선택\n\n```jsp\n// .xls (구버전, 호환성 중요)\nExcelReader excel = new ExcelReader(filePath);\n\n// .xlsx (신버전, 더 많은 기능)\nExcelX excel = new ExcelX();\n```\n\n### 2. 대용량 처리\n\n```jsp\n// Bad - 메모리 부족 가능\nDataSet data = excel.read(\"large_file.xlsx\");\n\n// Good - 배치 처리\nint batchSize = 1000;\nfor(int i = 0; i < totalRows; i += batchSize) {\n    // 일부씩 처리\n}\n```\n\n### 3. 에러 처리\n\n```jsp\ntry {\n    ExcelX excel = new ExcelX();\n    DataSet data = excel.read(filePath);\n\n    if(data.size() == 0) {\n        throw new Exception(\"데이터가 없습니다\");\n    }\n\n    // 처리...\n\n} catch(Exception e) {\n    m.jsError(\"Excel 처리 중 오류: \" + e.getMessage());\n}\n```\n\n### 4. 사용자 파일 업로드 검증\n\n```jsp\n// 파일 확장자 검증\nf.addElement(\"excel_file\", null, \"required:Y, accept:'.xlsx,.xls'\");\n\nif(m.isPost() && f.validate()) {\n\n    String fileName = f.getFileName(\"excel_file\");\n    String ext = fileName.substring(fileName.lastIndexOf(\".\"));\n\n    if(!\".xlsx\".equalsIgnoreCase(ext) && !\".xls\".equalsIgnoreCase(ext)) {\n        m.jsError(\"Excel 파일만 업로드 가능합니다\");\n        return;\n    }\n\n    // 처리...\n}\n```\n\n---\n\n## 다음 단계\n\n- [인증 처리](authentication.md)로 이동하여 로그인/로그아웃 구현 방법을 배워보세요.\n\n---\n\n[← 이전: XML 처리](xml.md) | [목차로 돌아가기](README.md) | [다음: 인증 처리 →](authentication.md)",
  "sections": [
    { "heading": "Excel 클래스 개요", "content": "ExcelReader(.xls 읽기 전용), ExcelWriter(.xls 쓰기 전용), ExcelX(.xlsx 읽기/쓰기) 세 가지 클래스를 제공합니다." },
    { "heading": "ExcelReader - Excel 읽기 (.xls)", "content": "ExcelReader의 기본 사용법과 여러 시트 읽기 방법입니다." },
    { "heading": "ExcelX - Excel 읽기/쓰기 (.xlsx)", "content": "ExcelX를 사용한 Excel 읽기, 단일/다중 시트 쓰기, 비밀번호 보호 기능입니다." },
    { "heading": "실전 예제", "content": "DB 조회 결과를 Excel로 변환, Excel 업로드 및 일괄 처리, 검색 결과 다운로드, 월별 통계 생성 예제입니다." },
    { "heading": "디버깅", "content": "ExcelReader와 ExcelX의 setDebug(out)을 사용한 디버깅 방법입니다." },
    { "heading": "성능 최적화", "content": "대용량 파일 처리와 메모리 관리(close() 호출) 방법입니다." },
    { "heading": "주요 메소드 정리", "content": "ExcelReader와 ExcelX의 주요 메소드 및 컬럼 정의 형식입니다." },
    { "heading": "베스트 프랙티스", "content": "파일 형식 선택, 대용량 처리, 에러 처리, 사용자 파일 업로드 검증 등의 모범 사례입니다." }
  ],
  "related_docs": ["file-upload-download", "authentication"],
  "related_classes": ["ExcelX", "ExcelReader", "DataSet", "Malgn", "Form", "ListManager", "DataObject"]
}

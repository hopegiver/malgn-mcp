{
  "slug": "calendar",
  "title": "달력 및 날짜 선택",
  "category": "util",
  "content": "# 달력 및 날짜 선택\n\n[← 목차로 돌아가기](README.md)\n\n---\n\n## 개요\n\nMCal 클래스는 달력 UI와 날짜 선택 기능을 제공합니다. 년/월/일/시/분 선택 UI를 쉽게 생성할 수 있습니다.\n\n### 주요 기능\n\n- **Select Box 생성**: 년/월/일/시/분 선택 옵션\n- **달력 데이터**: 월별 달력 데이터 생성\n- **주차 계산**: 요일 번호, 주의 첫날/마지막날\n- **유연한 범위**: 년도 범위 설정 가능\n\n---\n\n## 년/월/일 선택\n\n### 1. 년도 선택 (Select Box)\n\n```jsp\n<%@ page contentType=\"text/html; charset=utf-8\" %><%@ include file=\"/init.jsp\" %><%\n\nMCal cal = new MCal();\n\n// 현재 년도 기준 앞뒤 5년 (기본값)\nDataSet years = cal.getYears();\n\np.setBody(\"main.date_form\");\np.setLoop(\"years\", years);\np.display();\n\n%>\n```\n\n### 2. 년도 범위 설정\n\n```jsp\n// 앞뒤 10년\nMCal cal = new MCal(10);\nDataSet years = cal.getYears();\n\n// 또는\nMCal cal = new MCal();\ncal.setYearRange(10);\nDataSet years = cal.getYears();\n\n// 특정 년도 기준\nDataSet years = cal.getYears(2020);  // 2020 기준 앞뒤 5년\nDataSet years = cal.getYears(\"2020\");\n```\n\n### 3. 월 선택\n\n```jsp\n<%@ page contentType=\"text/html; charset=utf-8\" %><%@ include file=\"/init.jsp\" %><%\n\nMCal cal = new MCal();\nDataSet months = cal.getMonths();\n\np.setBody(\"main.month_form\");\np.setLoop(\"months\", months);\np.display();\n\n%>\n```\n\n### 4. 일 선택\n\n```jsp\nMCal cal = new MCal();\nDataSet days = cal.getDays();\n\n// 1일 ~ 31일까지\n```\n\n### 5. 전체 날짜 선택 폼\n\n```jsp\n<%@ page contentType=\"text/html; charset=utf-8\" %><%@ include file=\"/init.jsp\" %><%\n\nMCal cal = new MCal();\n\nDataSet years = cal.getYears();\nDataSet months = cal.getMonths();\nDataSet days = cal.getDays();\n\np.setBody(\"main.full_date_form\");\np.setLoop(\"years\", years);\np.setLoop(\"months\", months);\np.setLoop(\"days\", days);\np.display();\n\n%>\n```\n\n---\n\n## 시/분 선택\n\n### 1. 시간 선택 (0~23시)\n\n```jsp\nMCal cal = new MCal();\nDataSet hours = cal.getHours();\n\n// 00, 01, 02, ... 23\n```\n\n### 2. 분 선택\n\n```jsp\nMCal cal = new MCal();\n\n// 1분 간격 (00 ~ 59)\nDataSet minutes = cal.getMinutes();\n\n// 5분 간격 (00, 05, 10, ... 55)\nDataSet minutes5 = cal.getMinutes(5);\n\n// 10분 간격 (00, 10, 20, ... 50)\nDataSet minutes10 = cal.getMinutes(10);\n\n// 15분 간격 (00, 15, 30, 45)\nDataSet minutes15 = cal.getMinutes(15);\n```\n\n### 3. 시간/분 선택 폼\n\n```jsp\n<%@ page contentType=\"text/html; charset=utf-8\" %><%@ include file=\"/init.jsp\" %><%\n\nMCal cal = new MCal();\nDataSet hours = cal.getHours();\nDataSet minutes = cal.getMinutes(10);  // 10분 간격\n\np.setBody(\"main.time_form\");\np.setLoop(\"hours\", hours);\np.setLoop(\"minutes\", minutes);\np.display();\n\n%>\n```\n\n---\n\n## 달력 데이터 생성\n\n### 1. 월별 달력 데이터\n\n```jsp\n<%@ page contentType=\"text/html; charset=utf-8\" %><%@ include file=\"/init.jsp\" %><%\n\nMCal cal = new MCal();\n\n// 현재 월 달력 데이터\nString currentDate = m.time(\"yyyy-MM-dd\");\nDataSet calendar = cal.getMonthDays(currentDate);\n\n// 특정 월 달력 데이터\nDataSet calendar2 = cal.getMonthDays(\"2025-06-01\");\n\np.setBody(\"main.calendar\");\np.setLoop(\"days\", calendar);\np.display();\n\n%>\n```\n\n**DataSet 구조**:\n- `date`: 날짜 (yyyy-MM-dd 형식)\n- `type`: \"1\" (이전달), \"2\" (현재달), \"3\" (다음달)\n- `weeknum`: 요일 번호 (1=일요일, 2=월요일, ..., 7=토요일)\n- `__last`: 마지막 행 여부 (Boolean)\n\n### 2. 일정이 있는 달력\n\n```jsp\n<%@ page contentType=\"text/html; charset=utf-8\" %><%@ include file=\"/init.jsp\" %><%\n\nString month = m.rs(\"month\", m.time(\"yyyy-MM\"));\n\nMCal cal = new MCal();\nDataSet calendar = cal.getMonthDays(month + \"-01\");\n\n// 해당 월의 일정 조회\nEventDao event = new EventDao();\nDataSet list = event.find(\"event_date >= ? AND event_date < ?\",\n    new Object[] { month + \"-01\", Malgn.addMonth(1, month + \"-01\") });\n\n// 날짜별로 일정 카운트\nHashtable<String, Integer> eventCounts = new Hashtable<>();\nwhile(list.next()) {\n    String date = list.s(\"event_date\");\n    eventCounts.put(date, eventCounts.getOrDefault(date, 0) + 1);\n}\n\n// 달력 데이터에 일정 카운트 추가\nwhile(calendar.next()) {\n    String date = calendar.s(\"date\");\n    int count = eventCounts.getOrDefault(date, 0);\n    calendar.put(\"event_count\", count);\n}\n\np.setBody(\"main.event_calendar\");\np.setLoop(\"days\", calendar);\np.setVar(\"month\", month);\np.setVar(\"prev_month\", Malgn.addMonth(-1, month + \"-01\").substring(0, 7));\np.setVar(\"next_month\", Malgn.addMonth(1, month + \"-01\").substring(0, 7));\np.display();\n\n%>\n```\n\n---\n\n## 날짜 범위 선택\n\n### 1. 시작일/종료일 선택\n\n```jsp\n<%@ page contentType=\"text/html; charset=utf-8\" %><%@ include file=\"/init.jsp\" %><%\n\nMCal cal = new MCal();\n\nDataSet years = cal.getYears();\nDataSet months = cal.getMonths();\nDataSet days = cal.getDays();\n\np.setBody(\"main.date_range_form\");\np.setLoop(\"years\", years);\np.setLoop(\"months\", months);\np.setLoop(\"days\", days);\np.display();\n\n%>\n```\n\n### 2. 날짜 범위로 데이터 조회\n\n```jsp\n<%@ page contentType=\"text/html; charset=utf-8\" %><%@ include file=\"/init.jsp\" %><%\n\nif(m.isPost()) {\n\n    String startDate = f.get(\"start_year\") + \"-\" + f.get(\"start_month\") + \"-\" + f.get(\"start_day\");\n    String endDate = f.get(\"end_year\") + \"-\" + f.get(\"end_month\") + \"-\" + f.get(\"end_day\");\n\n    // 날짜 검증\n    if(Malgn.strToDate(\"yyyy-MM-dd\", startDate).after(Malgn.strToDate(\"yyyy-MM-dd\", endDate))) {\n        m.jsError(\"시작일이 종료일보다 늦을 수 없습니다.\");\n        return;\n    }\n\n    // 데이터 조회\n    OrderDao order = new OrderDao();\n    DataSet orderList = order.find(\"order_date >= ? AND order_date <= ?\",\n        new Object[] { startDate, endDate });\n\n    p.setBody(\"main.order_list\");\n    p.setLoop(\"orders\", orderList);\n    p.display();\n    return;\n}\n\n%>\n```\n\n---\n\n## 전체 예제\n\n### 예약 시스템\n\n```jsp\n<%@ page contentType=\"text/html; charset=utf-8\" %><%@ include file=\"/init.jsp\" %><%\n\nf.addElement(\"name\", null, \"required:'Y'\");\nf.addElement(\"phone\", null, \"required:'Y', type:'phone'\");\nf.addElement(\"year\", null, \"required:'Y'\");\nf.addElement(\"month\", null, \"required:'Y'\");\nf.addElement(\"day\", null, \"required:'Y'\");\nf.addElement(\"hour\", null, \"required:'Y'\");\nf.addElement(\"minute\", null, \"required:'Y'\");\n\nif(m.isPost() && f.validate()) {\n\n    String reservationDatetime = f.get(\"year\") + \"-\" + f.get(\"month\") + \"-\" + f.get(\"day\") + \" \" + f.get(\"hour\") + \":\" + f.get(\"minute\") + \":00\";\n\n    // 과거 날짜 체크\n    if(Malgn.strToDate(\"yyyy-MM-dd HH:mm:ss\", reservationDatetime).before(new Date())) {\n        m.jsError(\"과거 날짜는 예약할 수 없습니다.\");\n        return;\n    }\n\n    // 예약 저장\n    ReservationDao reservation = new ReservationDao();\n    reservation.item(\"name\", f.get(\"name\"));\n    reservation.item(\"phone\", f.get(\"phone\"));\n    reservation.item(\"reservation_datetime\", reservationDatetime);\n    reservation.item(\"status\", \"pending\");\n    reservation.item(\"reg_date\", m.time());\n    int newId = reservation.insert();\n\n    m.jsAlert(\"예약이 완료되었습니다.\");\n    m.jsReplace(\"reservation_view.jsp?id=\" + newId);\n    return;\n}\n\n%>\n```\n\n---\n\n## 요일 및 주차 계산\n\n### 1. 요일 번호 구하기\n\n```jsp\nMCal cal = new MCal();\n\n// 요일 번호 (1=일요일, 2=월요일, ..., 7=토요일)\nint weekNum = cal.getWeekNum(\"20250601\");\nint weekNum2 = cal.getWeekNum(\"2025-06-01\", \"yyyy-MM-dd\");\n\nm.p(\"요일 번호: \" + weekNum);\n```\n\n### 2. 주의 첫날/마지막날 구하기\n\n```jsp\nMCal cal = new MCal();\n\n// 해당 주의 첫날 (일요일)\nDate weekFirst = cal.getWeekFirstDate(\"20250601\");\nm.p(\"주의 첫날: \" + Malgn.getTimeString(\"yyyy-MM-dd\", weekFirst));\n\n// 해당 주의 마지막날 (토요일)\nDate weekLast = cal.getWeekLastDate(\"20250601\");\nm.p(\"주의 마지막날: \" + Malgn.getTimeString(\"yyyy-MM-dd\", weekLast));\n\n// 월의 마지막날\nDate monthLast = cal.getMonthLastDate(\"20250601\");\nm.p(\"월의 마지막날: \" + Malgn.getTimeString(\"yyyy-MM-dd\", monthLast));\n```\n\n---\n\n## 베스트 프랙티스\n\n### 1. 현재 날짜 선택 상태로 표시\n\n```jsp\np.setVar(\"current_year\", m.time(\"yyyy\"));\np.setVar(\"current_month\", m.time(\"MM\"));\np.setVar(\"current_day\", m.time(\"dd\"));\n```\n\n### 2. JavaScript로 동적 처리\n\n월에 따라 일자 선택을 동적으로 변경합니다.\n\n### 3. 오늘 날짜 하이라이트\n\n```jsp\np.setVar(\"today\", m.time(\"yyyy-MM-dd\"));\n```\n\n---\n\n## 참고 문서\n\n- [템플릿](template.md)\n- [DataSet 활용](dataset.md)\n- [유틸리티 메소드 - 날짜/시간](utility-methods.md#날짜시간-처리)\n\n---\n\n[← 목차로 돌아가기](README.md)",
  "sections": [
    { "heading": "개요", "content": "MCal 클래스의 달력 UI와 날짜 선택 기능으로 년/월/일/시/분 선택 UI, 달력 데이터 생성, 주차 계산 기능을 제공합니다." },
    { "heading": "년/월/일 선택", "content": "년도(getYears), 월(getMonths), 일(getDays) Select Box 생성과 년도 범위 설정 방법입니다." },
    { "heading": "시/분 선택", "content": "시간(getHours, 0~23시)과 분(getMinutes, 간격 설정 가능) 선택 UI 생성 방법입니다." },
    { "heading": "달력 데이터 생성", "content": "getMonthDays()를 사용한 월별 달력 데이터 생성, 달력 HTML, 일정이 있는 달력 구현 방법입니다." },
    { "heading": "날짜 범위 선택", "content": "시작일/종료일 선택 폼과 날짜 범위로 데이터를 조회하는 방법입니다." },
    { "heading": "전체 예제", "content": "예약 시스템 구현 예제로 날짜/시간 선택, 과거 날짜 체크, 중복 예약 체크 기능을 포함합니다." },
    { "heading": "요일 및 주차 계산", "content": "요일 번호(getWeekNum), 주의 첫날/마지막날(getWeekFirstDate/getWeekLastDate), 월의 마지막날(getMonthLastDate) 계산 방법입니다." },
    { "heading": "베스트 프랙티스", "content": "현재 날짜 선택 상태 표시, JavaScript 동적 처리, 오늘 날짜 하이라이트 등의 모범 사례입니다." }
  ],
  "related_docs": ["excel", "file-upload-download"],
  "related_classes": ["MCal", "Malgn", "Form", "Page", "DataSet"]
}
